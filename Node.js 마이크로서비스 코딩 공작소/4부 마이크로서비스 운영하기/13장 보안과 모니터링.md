# 4부 마이크로서비스 운영하기

## 13장 보안과 모니터링

### 1. 보안

<p>
    마이크로서비스 아키텍처는 API를 기반으로 동작한다. 대상에 따라 노출해도 되는 API와 노출하면 안되는 API가 있다. 이를 관리하는 대표적인 방법은 오픈 API에서 사용자마다 접근 가능한 권한을 별도로 관리하는 것이다. 오픈 API가 아닐 때 외부에서 자유롭게 접근 가능한 API와 신뢰할 수 있는 시스템에서만 접근 가능한 API로 구분하는 방식이 있다.
</p>

#### 1-1 Public과 Private 영역

<p>
    상품을 조회하는 API는 사용자에게 노출해도 되는 API이지만, 상품 삭제 및 등록은 특정 운영자에게만 노출해야 하는 API이다.
</p>

![1](https://user-images.githubusercontent.com/38815618/98528224-5c71ec80-22bf-11eb-9c99-12026d30b830.PNG)

<p>
    사용자에게 노출해도 되는 API를 Public API라고 하며, 노출하면 안 되는 Private API라고 한다. 보안상 Public API와 Private API의 접근을 제한하는 효과적인 방법은 네트워크 환경을 분리하는 것이다.
</p>

#### 1-2 Public 게이트웨이

<p>
    앞서 만든 게이트웨이는 모든 API에 접근 가능한 Private 게이트웨이이다. Public 게이트웨이를 만든다면 고려해야 할 기본 사항은 다음과 같다.
</p>

1. 제한된 API만 허용한다.
2. https 모듈로 SSL 보안 통신을 이용한다.
3. HTTPS 통신을 하더라도 GET과 DELETE 방식은 보안상 위험하다.
    - GET과 DELETE 메서드는 인자 값이 모두 노출되기 때문에 POST나 PUT 메서드를 활용해야 안전하다.

### 2. 모니터링

<p>
    마이크로서비스는 프로세스 단위이기 때문에 CPU 사용량이나 메모리 사용량 등 프로세스 레벨의 모니터링이 가능하다.
</p>

#### 2-1 process 오브젝트를 이용한 모니터링

- process 오브젝트를 이용해 수집할 수 있는 프로세스 정보
  - process.title: 프로세스 이름
  - process.pid: 프로세스 아이디
  - process.cwd(): 실행 경로
  - process.uptime(): 실행 시간
  - process.cpuUsage(): CPU 사용량
  - process.memoryUsage(): 메모리 사용량
  - process.platform: 운영체제
  - ...

#### 2-2 API별 모니터링

<p>
    특정 API의 호출 빈도가 급증하거나 특정 API의 응답 시간이 느려졌을 때를 파악해야 서비스가 중단되는 상황을 예방할 수 있다. API별 정보 수집은 게이트웨이에서 처리하는 것이 효과적이다. 일반적으로 API는 게이트웨이로 호출하기 때문에 게이트웨이가 요청과 응답 정보를 수집하면, 현재 마이크로서비스들이 어떤 상태로 서비스하는지 파악할 수 있다.
</p>

![2](https://user-images.githubusercontent.com/38815618/98528226-5da31980-22bf-11eb-90f2-d864a56f1052.PNG)
